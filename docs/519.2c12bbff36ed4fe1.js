"use strict";(self.webpackChunkng_libs=self.webpackChunkng_libs||[]).push([[519],{519:(pt,Q,o)=>{o.r(Q),o.d(Q,{RX_DATA_STORE_ROUTES:()=>ct});var g=o(6895),e=o(4650),F=o(4707),J=o(8675),K=o(9300),N=o(8372),B=o(3900),p=o(9646),$=o(8505),C=o(262),y=o(8746),M=o(4782),Z=o(4004),z=o(1135),L=o(5684),X=o(1884),D=o(7579),S=o(2843),E=o(5577),Y=o(7359),U=o(4482),A=o(5403),G=o(8421),V=o(4671),O=o(5032),W=o(3269),w=o(515);class k{constructor(){this.requestsCount=0,this.mutationsQueue$=new D.x,this.mutations$=this.mutationsQueue$.pipe((0,E.z)(t=>t,1),function H(n,t){return(0,U.e)((0,Y.U)(n,t,arguments.length>=2,!1,!0))}((t,i)=>(t.push(i),t),[]),(0,Z.U)(t=>i=>t.reduce((s,[a,u])=>u?u(s,a):s,i)))}add(t,i,s){this.requestsCount+=1,this.mutationsQueue$.next(t.pipe(function P(...n){const t=(0,W.jO)(n);return(0,U.e)((i,s)=>{const a=n.length,u=new Array(a);let d=n.map(()=>!1),v=!1;for(let c=0;c<a;c++)(0,G.Xf)(n[c]).subscribe((0,A.x)(s,T=>{u[c]=T,!v&&!d[c]&&(d[c]=!0,(v=d.every(V.y))&&(d=null))},O.Z));i.subscribe((0,A.x)(s,c=>{if(v){const T=[c,...u];s.next(t?t(...T):T)}}))})}((0,p.of)(i)),(0,C.K)(a=>(s?.(a),w.E)),(0,y.x)(()=>{this.requestsCount-=1,0===this.requestsCount&&this.mutationsQueue$.complete()})))}}class x{constructor(t,i,s=!1){this.dataSource=t,this.args=i,this.useCache=s,this.cache=new Map,this.dispatcher$=new F.t(1),this.data$=this.dispatcher$.pipe((0,J.O)(void 0),(0,K.h)(a=>!(void 0===a&&!this.args)),(0,N.b)(0),(0,B.w)(a=>{if(void 0!==a)return(0,p.of)(a);let u;return this.useCache&&(u=this.buildCacheKey(this.args),u&&this.cache.has(u))?(0,p.of)(this.cache.get(u)):(this._pending$.next(!0),this.dataSource(...this.args).pipe((0,$.b)(d=>{this.useCache&&u&&this.cache.set(u,d)}),(0,C.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1))))}),(0,$.b)(a=>this._dataSnapshot=a),(0,M.d)(1),(0,Z.U)(a=>this._map(a))),this._pending$=new z.X(!1),this.pending$=this._pending$.pipe((0,L.T)(1),(0,X.x)()),this._error$=new D.x,this.error$=this._error$.asObservable()}get dataSnapshot(){if(void 0!==this._dataSnapshot)return this._map(this._dataSnapshot)}fetch(...t){this.args=t,this.dispatcher$.next(void 0)}refresh(){if(this.args){if(this.useCache){const t=this.buildCacheKey(this.args);t&&this.cache.delete(t)}this.dispatcher$.next(void 0)}}mutation(t,i){return this._pending$.next(!0),t.pipe((0,$.b)(s=>i&&this.updateData(a=>i(a,s))),(0,C.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1)))}mutationQueue(t,i){this.requestsQueue||(this.requestsQueue=new k,this.requestsQueue.mutations$.subscribe(s=>{this.requestsQueue=void 0,this.updateData(s,!0)})),this._pending$.next(!0),this.requestsQueue.add(t,i,this.handleError.bind(this))}pending(t=!0){this._pending$.next(t)}setData(t,i=!1){this.dispatcher$.next(t),i&&this._pending$.next(!1)}updateData(t,i=!1){const s=this.dataSnapshot;if(void 0===s)return i&&this._pending$.next(!1),void console.error("RxDataStore: unable to update data because the data snapshot is undefined.");this.setData(t(s),i)}clearCache(){this.cache.clear()}_map(t){return this.map?"noop"!==this.map?this.map(t):t:x.map?x.map(t):t}buildCacheKey(t){try{return JSON.stringify(t)}catch{console.error("RxDataStore: unable to build cache key from arguments",t)}}handleError(t){return this._error$.next(t),(0,S._)(()=>t)}}var _=o(4986),tt=o(7272),q=o(5698),it=o(9718);function R(n,t){return t?i=>(0,tt.z)(t.pipe((0,q.q)(1),function et(){return(0,U.e)((n,t)=>{n.subscribe((0,A.x)(t,O.Z))})}()),i.pipe(R(n))):(0,E.z)((i,s)=>n(i,s).pipe((0,q.q)(1),(0,it.h)(i)))}var st=o(5963);function h(n,t=_.z){const i=(0,st.H)(n,t);return R(()=>i)}let nt=0;const r=()=>++nt;let l=[{userId:1,id:r(),title:"delectus aut autem",completed:!1},{userId:1,id:r(),title:"quis ut nam facilis et officia qui",completed:!1},{userId:1,id:r(),title:"fugiat veniam minus",completed:!1},{userId:1,id:r(),title:"et porro tempora",completed:!0},{userId:1,id:r(),title:"laboriosam mollitia et enim quasi adipisci quia provident illum",completed:!1},{userId:2,id:r(),title:"qui ullam ratione quibusdam voluptatem quia omnis",completed:!1},{userId:2,id:r(),title:"illo expedita consequatur quia in",completed:!1},{userId:2,id:r(),title:"quo adipisci enim quam ut ab",completed:!0},{userId:2,id:r(),title:"molestiae perspiciatis ipsa",completed:!1},{userId:3,id:r(),title:"illo est ratione doloremque quia maiores aut",completed:!0},{userId:3,id:r(),title:"vero rerum temporibus dolor",completed:!0},{userId:3,id:r(),title:"ipsa repellendus fugit nisi",completed:!0},{userId:3,id:r(),title:"et doloremque nulla",completed:!1},{userId:3,id:r(),title:"repellendus sunt dolores architecto voluptatum",completed:!0},{userId:3,id:r(),title:"ab voluptatum amet voluptas",completed:!0},{userId:4,id:r(),title:"accusamus eos facilis sint et aut voluptatem",completed:!0},{userId:4,id:r(),title:"quo laboriosam deleniti aut qui",completed:!0},{userId:4,id:r(),title:"dolorum est consequatur ea mollitia in culpa",completed:!1},{userId:4,id:r(),title:"molestiae ipsa aut voluptatibus pariatur dolor nihil",completed:!0},{userId:4,id:r(),title:"ullam nobis libero sapiente ad optio sint",completed:!0},{userId:5,id:r(),title:"suscipit repellat esse quibusdam voluptatem incidunt",completed:!1},{userId:5,id:r(),title:"distinctio vitae autem nihil ut molestias quo",completed:!0},{userId:5,id:r(),title:"et itaque necessitatibus maxime molestiae qui quas velit",completed:!1}];const j=n=>[...n.map(t=>({...t}))],I=(n,t)=>n.findIndex(({id:i})=>i===t),m=2e3,ot=n=>(0,p.of)(j(l)).pipe((0,Z.U)(t=>t.filter(i=>i.userId===n)),h(m));class f extends x{constructor(){super(ot),this.map=j}update(t){this.mutationQueue((n=>{const t=I(l,n.id);if(-1===t)return(0,S._)(()=>new Error(`Unable to update todo with id=${n.id}`)).pipe(h(m));const{title:i,completed:s}=n;return l[t]={...l[t],title:i,completed:s},(0,p.of)({...l[t],title:i,completed:s}).pipe(h(m))})(t),(i,s)=>(i[I(i,s.id)]=s,i))}remove(t){this.mutationQueue((n=>{const t=I(l,n);if(-1===t)return(0,S._)(()=>new Error(`Unable to remove todo with id=${n}`)).pipe(h(m));const[i]=l.splice(t,1);return(0,p.of)(i).pipe(h(m))})(t),i=>{const s=I(i,t);return i.splice(s,1),i})}add(t){this.mutationQueue((n=>{const t=r();return l.push({...n,id:t}),(0,p.of)({...n,id:t}).pipe(h(m))})(t),(i,s)=>(i.push(s),i))}static#t=this.\u0275fac=function(i){return new(i||f)};static#e=this.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}function dt(n,t){if(1&n){const i=e.EpF();e.TgZ(0,"p")(1,"button",3),e.NdJ("click",function(){const u=e.CHM(i).$implicit,d=e.oxw();return e.KtG(d.remove(u.id))}),e._uU(2,"Remove"),e.qZA(),e._uU(3," \xa0 "),e.TgZ(4,"button",3),e.NdJ("click",function(){const u=e.CHM(i).$implicit,d=e.oxw();return e.KtG(d.toggleCompleted(u))}),e._uU(5),e.qZA(),e._uU(6," \xa0 "),e.TgZ(7,"input",4,5),e.NdJ("change",function(){const u=e.CHM(i).$implicit,d=e.MAs(8),v=e.oxw();return e.KtG(v.updateTitle(u,d.value))}),e.qZA()()}if(2&n){const i=t.$implicit,s=e.oxw();e.xp6(5),e.hij(" ",i.completed?"Done":"Todo"," "),e.xp6(2),e.Q6J("value",i.title)("disabled",s.disabled.includes(i))}}function lt(n,t){if(1&n&&(e.TgZ(0,"pre"),e._uU(1),e.ALo(2,"json"),e.qZA()),2&n){const i=t.ngIf;e.xp6(1),e.hij("Todos ",e.lcZ(2,1,i),"")}}class b{constructor(t){this.demoService=t,this.userId=0,this.disabled=[],this.subscription=this.demoService.pending$.subscribe(i=>{!1===i&&(this.disabled=[])})}ngOnDestroy(){this.subscription.unsubscribe()}fetch(){this.userId=1+this.userId%5,this.demoService.fetch(this.userId)}update(){this.demoService.update({userId:1,id:3,title:"Updated",completed:!0})}remove(t){this.demoService.remove(t)}toggleCompleted(t){this.demoService.update({...t,completed:!t.completed})}updateTitle(t,i){this.disabled.push(t),this.demoService.update({...t,title:i})}trackById(t,{id:i}){return i}static#t=this.\u0275fac=function(i){return new(i||b)(e.Y36(f))};static#e=this.\u0275cmp=e.Xpm({type:b,selectors:[["app-demo"]],standalone:!0,features:[e.jDz],decls:24,vars:15,consts:[[3,"disabled","click"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[3,"click"],[3,"value","disabled","change"],["input",""]],template:function(i,s){1&i&&(e.TgZ(0,"h1"),e._uU(1,"RxDataStore"),e.qZA(),e.TgZ(2,"p")(3,"button",0),e.NdJ("click",function(){return s.fetch()}),e.ALo(4,"async"),e._uU(5,"Fetch todos for the next user"),e.qZA(),e._uU(6," \xa0 "),e.TgZ(7,"button",0),e.NdJ("click",function(){return s.update()}),e.ALo(8,"async"),e._uU(9,"Update"),e.qZA()(),e.TgZ(10,"p"),e._uU(11),e.qZA(),e.TgZ(12,"p"),e._uU(13),e.qZA(),e.TgZ(14,"p"),e._uU(15,' (*) It only applies to the text of a todo item which uses "mutationQueue()" function.'),e._UZ(16,"br"),e._uU(17,' Removing a todo item or changing its state uses regular "mutation()" function.'),e._UZ(18,"br"),e._uU(19," Note that the server simulates a slow internet connection and each request takes 2 seconds...\n"),e.qZA(),e.YNc(20,dt,9,3,"p",1),e.ALo(21,"async"),e.YNc(22,lt,3,3,"pre",2),e.ALo(23,"async")),2&i&&(e.xp6(3),e.Q6J("disabled",e.lcZ(4,7,s.demoService.pending$)),e.xp6(4),e.Q6J("disabled",e.lcZ(8,9,s.demoService.pending$)),e.xp6(4),e.hij("Current userId: ",s.userId||"",""),e.xp6(2),e.hij("Number of mutations in the queue (*): ",s.disabled.length,""),e.xp6(7),e.Q6J("ngForOf",e.lcZ(21,11,s.demoService.data$))("ngForTrackBy",s.trackById),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,13,s.demoService.data$)))},dependencies:[g.Ov,g.Ts,g.O5,g.ax],styles:["pre[_ngcontent-%COMP%]{margin:1rem 0;padding:.6rem .9rem;border-radius:4px;border:1px solid #eaeaea;background-color:#fafafa}"]})}const ct=[{path:"",component:b}]}}]);