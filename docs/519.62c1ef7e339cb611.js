"use strict";(self.webpackChunkng_libs=self.webpackChunkng_libs||[]).push([[519],{519:(xe,D,n)=>{n.r(D),n.d(D,{RX_DATA_STORE_ROUTES:()=>ve});var v=n(6895),Q=n(4859),E=n(9549),O=n(4144),q=n(455),j=n(8874),e=n(4650),B=n(4707),z=n(8675),L=n(9300),P=n(8372),Y=n(3900),h=n(9646),$=n(8505),b=n(262),y=n(8746),H=n(4782),Z=n(4004),X=n(1135),G=n(5684),W=n(1884),R=n(7579),A=n(2843),J=n(5577),V=n(7359),S=n(4482),U=n(5403),k=n(8421),_=n(4671),K=n(5032),ee=n(3269),ie=n(515);class se{constructor(){this.requestsCount=0,this.mutationsQueue$=new R.x,this.mutations$=this.mutationsQueue$.pipe((0,J.z)(t=>t,1),function w(o,t){return(0,S.e)((0,V.U)(o,t,arguments.length>=2,!1,!0))}((t,i)=>(t.push(i),t),[]),(0,Z.U)(t=>i=>t.reduce((s,[r,d])=>d?d(s,r):s,i)))}add(t,i,s){this.requestsCount+=1,this.mutationsQueue$.next(t.pipe(function te(...o){const t=(0,ee.jO)(o);return(0,S.e)((i,s)=>{const r=o.length,d=new Array(r);let u=o.map(()=>!1),g=!1;for(let c=0;c<r;c++)(0,k.Xf)(o[c]).subscribe((0,U.x)(s,C=>{d[c]=C,!g&&!u[c]&&(u[c]=!0,(g=u.every(_.y))&&(u=null))},K.Z));i.subscribe((0,U.x)(s,c=>{if(g){const C=[c,...d];s.next(t?t(...C):C)}}))})}((0,h.of)(i)),(0,b.K)(r=>(s?.(r),ie.E)),(0,y.x)(()=>{this.requestsCount-=1,0===this.requestsCount&&this.mutationsQueue$.complete()})))}}class x{constructor(t,i,s=!1){this.dataSource=t,this.args=i,this.useCache=s,this.cache=new Map,this.dispatcher$=new B.t(1),this.data$=this.dispatcher$.pipe((0,z.O)(void 0),(0,L.h)(r=>!(void 0===r&&!this.args)),(0,P.b)(0),(0,Y.w)(r=>{if(void 0!==r)return(0,h.of)(r);let d;return this.useCache&&(d=this.buildCacheKey(this.args),d&&this.cache.has(d))?(0,h.of)(this.cache.get(d)):(this._pending$.next(!0),this.dataSource(...this.args).pipe((0,$.b)(u=>{this.useCache&&d&&this.cache.set(d,u)}),(0,b.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1))))}),(0,$.b)(r=>this._dataSnapshot=r),(0,H.d)(1),(0,Z.U)(r=>this._map(r))),this._pending$=new X.X(!1),this.pending$=this._pending$.pipe((0,G.T)(1),(0,W.x)()),this._error$=new R.x,this.error$=this._error$.asObservable()}get dataSnapshot(){if(void 0!==this._dataSnapshot)return this._map(this._dataSnapshot)}fetch(...t){this.args=t,this.dispatcher$.next(void 0)}refresh(){if(this.args){if(this.useCache){const t=this.buildCacheKey(this.args);t&&this.cache.delete(t)}this.dispatcher$.next(void 0)}}mutation(t,i){return this._pending$.next(!0),t.pipe((0,$.b)(s=>i&&this.updateData(r=>i(r,s))),(0,b.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1)))}mutationQueue(t,i){this.requestsQueue||(this.requestsQueue=new se,this.requestsQueue.mutations$.subscribe(s=>{this.requestsQueue=void 0,this.updateData(s,!0)})),this._pending$.next(!0),this.requestsQueue.add(t,i,this.handleError.bind(this))}pending(t=!0){this._pending$.next(t)}setData(t,i=!1){this.dispatcher$.next(t),i&&this._pending$.next(!1)}updateData(t,i=!1){const s=this.dataSnapshot;if(void 0===s)return i&&this._pending$.next(!1),void console.error("RxDataStore: unable to update data because the data snapshot is undefined.");this.setData(t(s),i)}clearCache(){this.cache.clear()}_map(t){return this.map?"noop"!==this.map?this.map(t):t:x.map?x.map(t):t}buildCacheKey(t){try{return JSON.stringify(t)}catch{console.error("RxDataStore: unable to build cache key from arguments",t)}}handleError(t){return this._error$.next(t),(0,A._)(()=>t)}}var ne=n(4986),oe=n(7272),M=n(5698),re=n(9718);function F(o,t){return t?i=>(0,oe.z)(t.pipe((0,M.q)(1),function ae(){return(0,S.e)((o,t)=>{o.subscribe((0,U.x)(t,K.Z))})}()),i.pipe(F(o))):(0,J.z)((i,s)=>o(i,s).pipe((0,M.q)(1),(0,re.h)(i)))}var de=n(5963);function p(o,t=ne.z){const i=(0,de.H)(o,t);return F(()=>i)}let ue=0;const a=()=>++ue;let l=[{userId:1,id:a(),title:"delectus aut autem",completed:!1},{userId:1,id:a(),title:"quis ut nam facilis et officia qui",completed:!1},{userId:1,id:a(),title:"fugiat veniam minus",completed:!1},{userId:1,id:a(),title:"et porro tempora",completed:!0},{userId:1,id:a(),title:"laboriosam mollitia et enim quasi adipisci quia provident illum",completed:!1},{userId:2,id:a(),title:"qui ullam ratione quibusdam voluptatem quia omnis",completed:!1},{userId:2,id:a(),title:"illo expedita consequatur quia in",completed:!1},{userId:2,id:a(),title:"quo adipisci enim quam ut ab",completed:!0},{userId:2,id:a(),title:"molestiae perspiciatis ipsa",completed:!1},{userId:3,id:a(),title:"illo est ratione doloremque quia maiores aut",completed:!0},{userId:3,id:a(),title:"vero rerum temporibus dolor",completed:!0},{userId:3,id:a(),title:"ipsa repellendus fugit nisi",completed:!0},{userId:3,id:a(),title:"et doloremque nulla",completed:!1},{userId:3,id:a(),title:"repellendus sunt dolores architecto voluptatum",completed:!0},{userId:3,id:a(),title:"ab voluptatum amet voluptas",completed:!0},{userId:4,id:a(),title:"accusamus eos facilis sint et aut voluptatem",completed:!0},{userId:4,id:a(),title:"quo laboriosam deleniti aut qui",completed:!0},{userId:4,id:a(),title:"dolorum est consequatur ea mollitia in culpa",completed:!1},{userId:4,id:a(),title:"molestiae ipsa aut voluptatibus pariatur dolor nihil",completed:!0},{userId:4,id:a(),title:"ullam nobis libero sapiente ad optio sint",completed:!0},{userId:5,id:a(),title:"suscipit repellat esse quibusdam voluptatem incidunt",completed:!1},{userId:5,id:a(),title:"distinctio vitae autem nihil ut molestias quo",completed:!0},{userId:5,id:a(),title:"et itaque necessitatibus maxime molestiae qui quas velit",completed:!1}];const N=o=>[...o.map(t=>({...t}))],I=(o,t)=>o.findIndex(({id:i})=>i===t),m=1500,le=o=>(0,h.of)(N(l)).pipe((0,Z.U)(t=>t.filter(i=>i.userId===o)),p(m));class f extends x{constructor(){super(le),this.map=N}update(t){this.mutationQueue((o=>{const t=I(l,o.id);if(-1===t)return(0,A._)(()=>new Error(`Unable to update todo with id=${o.id}`)).pipe(p(m));const{title:i,completed:s}=o;return l[t]={...l[t],title:i,completed:s},(0,h.of)({...l[t],title:i,completed:s}).pipe(p(m))})(t),(i,s)=>(i[I(i,s.id)]=s,i))}remove(t){this.mutationQueue((o=>{const t=I(l,o);if(-1===t)return(0,A._)(()=>new Error(`Unable to remove todo with id=${o}`)).pipe(p(m));const[i]=l.splice(t,1);return(0,h.of)(i).pipe(p(m))})(t),i=>{const s=I(i,t);return i.splice(s,1),i})}add(t){this.mutationQueue((o=>{const t=a();return l.push({...o,id:t}),(0,h.of)({...o,id:t}).pipe(p(m))})(t),(i,s)=>(i.push(s),i))}static#e=this.\u0275fac=function(i){return new(i||f)};static#t=this.\u0275prov=e.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}function me(o,t){if(1&o&&(e.TgZ(0,"h2"),e._uU(1),e.qZA()),2&o){const i=e.oxw();e.xp6(1),e.hij("Todo list for user with ID: ",i.userId||"","")}}function fe(o,t){if(1&o){const i=e.EpF();e.TgZ(0,"p")(1,"button",7),e.NdJ("click",function(){const d=e.CHM(i).$implicit,u=e.oxw();return e.KtG(u.remove(d.id))}),e._uU(2,"Remove"),e.qZA(),e._uU(3," \xa0 "),e.TgZ(4,"mat-slide-toggle",8),e.NdJ("change",function(){const d=e.CHM(i).$implicit,u=e.oxw();return e.KtG(u.toggleCompleted(d))}),e.qZA(),e._uU(5," \xa0 "),e.TgZ(6,"mat-form-field",9)(7,"input",10,11),e.NdJ("change",function(){const d=e.CHM(i).$implicit,u=e.MAs(8),g=e.oxw();return e.KtG(g.updateTitle(d,u.value))}),e.qZA()(),e._uU(9),e.qZA()}if(2&o){const i=t.$implicit,s=e.oxw();e.xp6(1),e.Q6J("disabled",s.disabledTodoIds.has(i.id)),e.xp6(3),e.Q6J("disabled",s.disabledTodoIds.has(i.id))("checked",i.completed),e.xp6(3),e.Q6J("disabled",s.disabledTodoIds.has(i.id))("value",i.title),e.xp6(2),e.hij(" \xa0 ",i.completed?"\u2714":"\u2716"," ")}}function ge(o,t){if(1&o&&(e.TgZ(0,"pre",12),e._uU(1),e.ALo(2,"json"),e.qZA()),2&o){const i=t.ngIf;e.xp6(1),e.hij("Todos ",e.lcZ(2,1,i),"")}}class T{constructor(t){this.demoService=t,this.userId=0,this.disabledTodoIds=new Set,this.subscription=this.demoService.pending$.subscribe(i=>{!1===i&&this.disabledTodoIds.clear()})}ngOnDestroy(){this.subscription.unsubscribe()}fetch(){this.userId=1+this.userId%5,this.demoService.fetch(this.userId)}remove(t){this.demoService.remove(t),this.disabledTodoIds.add(t)}toggleCompleted(t){t.completed=!t.completed,this.demoService.update(t)}updateTitle(t,i){t.title=i,this.demoService.update(t)}trackById(t,{id:i}){return i}static#e=this.\u0275fac=function(i){return new(i||T)(e.Y36(f))};static#t=this.\u0275cmp=e.Xpm({type:T,selectors:[["app-demo"]],standalone:!0,features:[e.jDz],decls:25,vars:14,consts:[["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],[1,"demo"],[1,"demo__form"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","demo__data",4,"ngIf"],["linkHref","https://github.com/avine/ng-libs/tree/main/src/app/rx-data-store/demo"],["mat-button","",3,"disabled","click"],[3,"disabled","checked","change"],["appearance","fill"],["matInput","",3,"disabled","value","change"],["input",""],[1,"demo__data"]],template:function(i,s){1&i&&(e.TgZ(0,"h1"),e._uU(1,"RxDataStore"),e.qZA(),e.TgZ(2,"p"),e._uU(3," Note that the server simulates a slow internet connection and each request takes 1.5 seconds."),e._UZ(4,"br"),e._uU(5," The request are queued using the "),e.TgZ(6,"code"),e._uU(7,"mutationQueue()"),e.qZA(),e._uU(8," method.\n"),e.qZA(),e.TgZ(9,"p")(10,"button",0),e.NdJ("click",function(){return s.fetch()}),e.ALo(11,"async"),e._uU(12," Fetch todos for the next user "),e.qZA(),e._uU(13," \xa0 "),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"async"),e.qZA()(),e.YNc(17,me,2,1,"h2",1),e.TgZ(18,"div",2)(19,"div",3),e.YNc(20,fe,10,6,"p",4),e.ALo(21,"async"),e.qZA(),e.YNc(22,ge,3,3,"pre",5),e.ALo(23,"async"),e.qZA(),e._UZ(24,"app-view-source",6)),2&i&&(e.xp6(10),e.Q6J("disabled",e.lcZ(11,6,s.demoService.pending$)),e.xp6(5),e.Oqu(e.lcZ(16,8,s.demoService.pending$)?"\u{1f680} Processing...":"\u{1f634} Idle."),e.xp6(2),e.Q6J("ngIf",s.userId),e.xp6(3),e.Q6J("ngForOf",e.lcZ(21,10,s.demoService.data$))("ngForTrackBy",s.trackById),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,12,s.demoService.data$)))},dependencies:[v.Ov,v.Ts,v.O5,v.ax,Q.ot,Q.lW,E.lN,E.KE,O.c,O.Nt,q.rP,q.Rr,j.t],styles:[".demo[_ngcontent-%COMP%]{display:flex}.demo__form[_ngcontent-%COMP%]{flex-shrink:0}.demo__data[_ngcontent-%COMP%]{flex-grow:1;overflow:auto;margin:0 0 0 2rem;padding:.6rem .9rem;border-radius:4px;border:1px solid #eaeaea;background-color:#fafafa;font-size:13px;line-height:16px}@media (max-width: 1280px){.demo[_ngcontent-%COMP%]{flex-direction:column}.demo__data[_ngcontent-%COMP%]{margin-left:0}}"]})}const ve=[{path:"",component:T}]}}]);