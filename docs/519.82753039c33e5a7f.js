"use strict";(self.webpackChunkng_libs=self.webpackChunkng_libs||[]).push([[519],{519:(pe,D,o)=>{o.r(D),o.d(D,{RX_DATA_STORE_ROUTES:()=>ce});var g=o(6895),t=o(4650),F=o(4707),J=o(8675),K=o(9300),B=o(8372),N=o(3900),p=o(9646),b=o(8505),C=o(262),y=o(8746),M=o(4782),S=o(4004),z=o(1135),L=o(5684),X=o(1884),Q=o(7579),Z=o(2843),E=o(5577),Y=o(7359),A=o(4482),U=o(5403),G=o(8421),V=o(4671),O=o(5032),W=o(3269),k=o(515);class w{constructor(){this.requestsCount=0,this.mutationsQueue$=new Q.x,this.mutations$=this.mutationsQueue$.pipe((0,E.z)(e=>e,1),function H(n,e){return(0,A.e)((0,Y.U)(n,e,arguments.length>=2,!1,!0))}((e,i)=>(e.push(i),e),[]),(0,S.U)(e=>i=>e.reduce((s,[a,u])=>u?u(s,a):s,i)))}add(e,i,s){this.requestsCount+=1,this.mutationsQueue$.next(e.pipe(function P(...n){const e=(0,W.jO)(n);return(0,A.e)((i,s)=>{const a=n.length,u=new Array(a);let d=n.map(()=>!1),v=!1;for(let c=0;c<a;c++)(0,G.Xf)(n[c]).subscribe((0,U.x)(s,$=>{u[c]=$,!v&&!d[c]&&(d[c]=!0,(v=d.every(V.y))&&(d=null))},O.Z));i.subscribe((0,U.x)(s,c=>{if(v){const $=[c,...u];s.next(e?e(...$):$)}}))})}((0,p.of)(i)),(0,C.K)(a=>(s?.(a),k.E)),(0,y.x)(()=>{this.requestsCount-=1,0===this.requestsCount&&this.mutationsQueue$.complete()})))}}class x{constructor(e,i,s=!1){this.dataSource=e,this.args=i,this.useCache=s,this.cache=new Map,this.dispatcher$=new F.t(1),this.data$=this.dispatcher$.pipe((0,J.O)(void 0),(0,K.h)(a=>!(void 0===a&&!this.args)),(0,B.b)(0),(0,N.w)(a=>{if(void 0!==a)return(0,p.of)(a);let u;return this.useCache&&(u=this.buildCacheKey(this.args),u&&this.cache.has(u))?(0,p.of)(this.cache.get(u)):(this._pending$.next(!0),this.dataSource(...this.args).pipe((0,b.b)(d=>{this.useCache&&u&&this.cache.set(u,d)}),(0,C.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1))))}),(0,b.b)(a=>this._dataSnapshot=a),(0,M.d)(1),(0,S.U)(a=>this._map(a))),this._pending$=new z.X(!1),this.pending$=this._pending$.pipe((0,L.T)(1),(0,X.x)()),this._error$=new Q.x,this.error$=this._error$.asObservable()}get dataSnapshot(){if(void 0!==this._dataSnapshot)return this._map(this._dataSnapshot)}fetch(...e){this.args=e,this.dispatcher$.next(void 0)}refresh(){if(this.args){if(this.useCache){const e=this.buildCacheKey(this.args);e&&this.cache.delete(e)}this.dispatcher$.next(void 0)}}mutation(e,i){return this._pending$.next(!0),e.pipe((0,b.b)(s=>i&&this.updateData(a=>i(a,s))),(0,C.K)(this.handleError.bind(this)),(0,y.x)(()=>this._pending$.next(!1)))}mutationQueue(e,i){this.requestsQueue||(this.requestsQueue=new w,this.requestsQueue.mutations$.subscribe(s=>{this.requestsQueue=void 0,this.updateData(s,!0)})),this._pending$.next(!0),this.requestsQueue.add(e,i,this.handleError.bind(this))}pending(e=!0){this._pending$.next(e)}setData(e,i=!1){this.dispatcher$.next(e),i&&this._pending$.next(!1)}updateData(e,i=!1){const s=this.dataSnapshot;if(void 0===s)return i&&this._pending$.next(!1),void console.error("RxDataStore: unable to update data because the data snapshot is undefined.");this.setData(e(s),i)}clearCache(){this.cache.clear()}_map(e){return this.map?"noop"!==this.map?this.map(e):e:x.map?x.map(e):e}buildCacheKey(e){try{return JSON.stringify(e)}catch{console.error("RxDataStore: unable to build cache key from arguments",e)}}handleError(e){return this._error$.next(e),(0,Z._)(()=>e)}}var _=o(4986),ee=o(7272),R=o(5698),ie=o(9718);function j(n,e){return e?i=>(0,ee.z)(e.pipe((0,R.q)(1),function te(){return(0,A.e)((n,e)=>{n.subscribe((0,U.x)(e,O.Z))})}()),i.pipe(j(n))):(0,E.z)((i,s)=>n(i,s).pipe((0,R.q)(1),(0,ie.h)(i)))}var se=o(5963);function h(n,e=_.z){const i=(0,se.H)(n,e);return j(()=>i)}let ne=0;const r=()=>++ne;let l=[{userId:1,id:r(),title:"delectus aut autem",completed:!1},{userId:1,id:r(),title:"quis ut nam facilis et officia qui",completed:!1},{userId:1,id:r(),title:"fugiat veniam minus",completed:!1},{userId:1,id:r(),title:"et porro tempora",completed:!0},{userId:1,id:r(),title:"laboriosam mollitia et enim quasi adipisci quia provident illum",completed:!1},{userId:2,id:r(),title:"qui ullam ratione quibusdam voluptatem quia omnis",completed:!1},{userId:2,id:r(),title:"illo expedita consequatur quia in",completed:!1},{userId:2,id:r(),title:"quo adipisci enim quam ut ab",completed:!0},{userId:2,id:r(),title:"molestiae perspiciatis ipsa",completed:!1},{userId:3,id:r(),title:"illo est ratione doloremque quia maiores aut",completed:!0},{userId:3,id:r(),title:"vero rerum temporibus dolor",completed:!0},{userId:3,id:r(),title:"ipsa repellendus fugit nisi",completed:!0},{userId:3,id:r(),title:"et doloremque nulla",completed:!1},{userId:3,id:r(),title:"repellendus sunt dolores architecto voluptatum",completed:!0},{userId:3,id:r(),title:"ab voluptatum amet voluptas",completed:!0},{userId:4,id:r(),title:"accusamus eos facilis sint et aut voluptatem",completed:!0},{userId:4,id:r(),title:"quo laboriosam deleniti aut qui",completed:!0},{userId:4,id:r(),title:"dolorum est consequatur ea mollitia in culpa",completed:!1},{userId:4,id:r(),title:"molestiae ipsa aut voluptatibus pariatur dolor nihil",completed:!0},{userId:4,id:r(),title:"ullam nobis libero sapiente ad optio sint",completed:!0},{userId:5,id:r(),title:"suscipit repellat esse quibusdam voluptatem incidunt",completed:!1},{userId:5,id:r(),title:"distinctio vitae autem nihil ut molestias quo",completed:!0},{userId:5,id:r(),title:"et itaque necessitatibus maxime molestiae qui quas velit",completed:!1}];const q=n=>[...n.map(e=>({...e}))],I=(n,e)=>n.findIndex(({id:i})=>i===e),m=2e3,oe=n=>(0,p.of)(q(l)).pipe((0,S.U)(e=>e.filter(i=>i.userId===n)),h(m));class f extends x{constructor(){super(oe),this.map=q}update(e){this.mutationQueue((n=>{const e=I(l,n.id);if(-1===e)return(0,Z._)(()=>new Error(`Unable to update todo with id=${n.id}`)).pipe(h(m));const{title:i,completed:s}=n;return l[e]={...l[e],title:i,completed:s},(0,p.of)({...l[e],title:i,completed:s}).pipe(h(m))})(e),(i,s)=>(i[I(i,s.id)]=s,i))}remove(e){this.mutationQueue((n=>{const e=I(l,n);if(-1===e)return(0,Z._)(()=>new Error(`Unable to remove todo with id=${n}`)).pipe(h(m));const[i]=l.splice(e,1);return(0,p.of)(i).pipe(h(m))})(e),i=>{const s=I(i,e);return i.splice(s,1),i})}add(e){this.mutationQueue((n=>{const e=r();return l.push({...n,id:e}),(0,p.of)({...n,id:e}).pipe(h(m))})(e),(i,s)=>(i.push(s),i))}static#e=this.\u0275fac=function(i){return new(i||f)};static#t=this.\u0275prov=t.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}function de(n,e){if(1&n){const i=t.EpF();t.TgZ(0,"p")(1,"button",3),t.NdJ("click",function(){const u=t.CHM(i).$implicit,d=t.oxw();return t.KtG(d.remove(u.id))}),t._uU(2,"Remove"),t.qZA(),t._uU(3," \xa0 "),t.TgZ(4,"button",3),t.NdJ("click",function(){const u=t.CHM(i).$implicit,d=t.oxw();return t.KtG(d.toggleCompleted(u))}),t._uU(5),t.qZA(),t._uU(6," \xa0 "),t.TgZ(7,"input",4,5),t.NdJ("change",function(){const u=t.CHM(i).$implicit,d=t.MAs(8),v=t.oxw();return t.KtG(v.updateTitle(u,d.value))}),t.qZA()()}if(2&n){const i=e.$implicit,s=t.oxw();t.xp6(5),t.hij(" ",i.completed?"Done":"Todo"," "),t.xp6(2),t.Q6J("value",i.title)("disabled",s.disabled.includes(i))}}function le(n,e){if(1&n&&(t.TgZ(0,"pre"),t._uU(1),t.ALo(2,"json"),t.qZA()),2&n){const i=e.ngIf;t.xp6(1),t.hij("Todos ",t.lcZ(2,1,i),"")}}class T{constructor(e){this.demoService=e,this.userId=0,this.disabled=[],this.subscription=this.demoService.pending$.subscribe(i=>{!1===i&&(this.disabled=[])})}ngOnDestroy(){this.subscription.unsubscribe()}fetch(){this.userId=1+this.userId%5,this.demoService.fetch(this.userId)}update(){this.demoService.update({userId:1,id:3,title:"Updated",completed:!0})}remove(e){this.demoService.remove(e)}toggleCompleted(e){this.demoService.update({...e,completed:!e.completed})}updateTitle(e,i){this.disabled.push(e),this.demoService.update({...e,title:i})}trackById(e,{id:i}){return i}static#e=this.\u0275fac=function(i){return new(i||T)(t.Y36(f))};static#t=this.\u0275cmp=t.Xpm({type:T,selectors:[["app-demo"]],standalone:!0,features:[t.jDz],decls:18,vars:15,consts:[[3,"disabled","click"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[3,"click"],[3,"value","disabled","change"],["input",""]],template:function(i,s){1&i&&(t.TgZ(0,"h1"),t._uU(1,"RxDataStore"),t.qZA(),t.TgZ(2,"p")(3,"button",0),t.NdJ("click",function(){return s.fetch()}),t.ALo(4,"async"),t._uU(5,"Fetch todos for the next user"),t.qZA(),t._uU(6," \xa0 "),t.TgZ(7,"button",0),t.NdJ("click",function(){return s.update()}),t.ALo(8,"async"),t._uU(9,"Update"),t.qZA()(),t.TgZ(10,"p"),t._uU(11),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA(),t.YNc(14,de,9,3,"p",1),t.ALo(15,"async"),t.YNc(16,le,3,3,"pre",2),t.ALo(17,"async")),2&i&&(t.xp6(3),t.Q6J("disabled",t.lcZ(4,7,s.demoService.pending$)),t.xp6(4),t.Q6J("disabled",t.lcZ(8,9,s.demoService.pending$)),t.xp6(4),t.hij("Current userId: ",s.userId||"",""),t.xp6(2),t.hij("Number of mutations in the queue: ",s.disabled.length,""),t.xp6(1),t.Q6J("ngForOf",t.lcZ(15,11,s.demoService.data$))("ngForTrackBy",s.trackById),t.xp6(2),t.Q6J("ngIf",t.lcZ(17,13,s.demoService.data$)))},dependencies:[g.Ov,g.Ts,g.O5,g.ax],styles:["pre[_ngcontent-%COMP%]{margin:1rem 0;padding:.6rem .9rem;border-radius:4px;border:1px solid #eaeaea;background-color:#fafafa}"]})}const ce=[{path:"",component:T}]}}]);