"use strict";(self.webpackChunkng_libs=self.webpackChunkng_libs||[]).push([[781],{8781:(ve,S,a)=>{a.r(S),a.d(S,{RX_DATA_STORE_ROUTES:()=>ge});var g=a(6814),A=a(2296),U=a(4170),Q=a(2032),E=a(2599),N=a(7352),e=a(5879),j=a(7328),B=a(7921),z=a(2181),L=a(3620),P=a(4664),m=a(2096),T=a(9397),C=a(6306),$=a(4716),X=a(7081),b=a(7398),Y=a(5619),H=a(836),G=a(3997),O=a(8645),y=a(8504),q=a(1631),W=a(9732),D=a(9360),Z=a(8251),R=a(4829),w=a(2737),J=a(2420),k=a(9940),ee=a(6232);class te{constructor(){this.requestsCount=0,this.mutationsQueue$=new O.x,this.mutations$=this.mutationsQueue$.pipe((0,q.z)(t=>t,1),function V(n,t){return(0,D.e)((0,W.U)(n,t,arguments.length>=2,!1,!0))}((t,s)=>(t.push(s),t),[]),(0,b.U)(t=>s=>t.reduce((i,[o,r])=>r?r(i,o):i,s)))}add(t,s,i){this.requestsCount+=1,this.mutationsQueue$.next(t.pipe(function _(...n){const t=(0,k.jO)(n);return(0,D.e)((s,i)=>{const o=n.length,r=new Array(o);let u=n.map(()=>!1),f=!1;for(let c=0;c<o;c++)(0,R.Xf)(n[c]).subscribe((0,Z.x)(i,I=>{r[c]=I,!f&&!u[c]&&(u[c]=!0,(f=u.every(w.y))&&(u=null))},J.Z));s.subscribe((0,Z.x)(i,c=>{if(f){const I=[c,...r];i.next(t?t(...I):I)}}))})}((0,m.of)(s)),(0,C.K)(o=>(i?.(o),ee.E)),(0,$.x)(()=>{this.requestsCount-=1,0===this.requestsCount&&this.mutationsQueue$.complete()})))}}class v{get dataSnapshot(){if(void 0!==this._dataSnapshot)return this._map(this._dataSnapshot)}constructor(t,s,i=!1){this.dataSource=t,this.args=s,this.useCache=i,this.cache=new Map,this.dispatcher$=new j.t(1),this.data$=this.dispatcher$.pipe((0,B.O)(void 0),(0,z.h)(o=>!(void 0===o&&!this.args)),(0,L.b)(0),(0,P.w)(o=>{if(void 0!==o)return(0,m.of)(o);let r;return this.useCache&&(r=this.buildCacheKey(this.args),r&&this.cache.has(r))?(0,m.of)(this.cache.get(r)):(this._pending$.next(!0),this.dataSource(...this.args).pipe((0,T.b)(u=>{this.useCache&&r&&this.cache.set(r,u)}),(0,C.K)(this.handleError.bind(this)),(0,$.x)(()=>this._pending$.next(!1))))}),(0,T.b)(o=>this._dataSnapshot=o),(0,X.d)(1),(0,b.U)(o=>this._map(o))),this._pending$=new Y.X(!1),this.pending$=this._pending$.pipe((0,H.T)(1),(0,G.x)()),this._error$=new O.x,this.error$=this._error$.asObservable()}fetch(...t){this.args=t,this.dispatcher$.next(void 0)}refresh(){if(this.args){if(this.useCache){const t=this.buildCacheKey(this.args);t&&this.cache.delete(t)}this.dispatcher$.next(void 0)}}mutation(t,s){return this._pending$.next(!0),t.pipe((0,T.b)(i=>s&&this.updateData(o=>s(o,i))),(0,C.K)(this.handleError.bind(this)),(0,$.x)(()=>this._pending$.next(!1)))}mutationQueue(t,s){this.requestsQueue||(this.requestsQueue=new te,this.requestsQueue.mutations$.subscribe(i=>{this.requestsQueue=void 0,this.updateData(i,!0)})),this._pending$.next(!0),this.requestsQueue.add(t,s,this.handleError.bind(this))}pending(t=!0){this._pending$.next(t)}setData(t,s=!1){this.dispatcher$.next(t),s&&this._pending$.next(!1)}updateData(t,s=!1){const i=this.dataSnapshot;if(void 0===i)return s&&this._pending$.next(!1),void console.error("RxDataStore: unable to update data because the data snapshot is undefined.");this.setData(t(i),s)}clearCache(){this.cache.clear()}_map(t){return this.map?"noop"!==this.map?this.map(t):t:v.map?v.map(t):t}buildCacheKey(t){try{return JSON.stringify(t)}catch{console.error("RxDataStore: unable to build cache key from arguments",t)}}handleError(t){return this._error$.next(t),(0,y._)(()=>t)}}var ie=a(6321),se=a(5211),K=a(8180),oe=a(975);function M(n,t){return t?s=>(0,se.z)(t.pipe((0,K.q)(1),function ne(){return(0,D.e)((n,t)=>{n.subscribe((0,Z.x)(t,J.Z))})}()),s.pipe(M(n))):(0,q.z)((s,i)=>(0,R.Xf)(n(s,i)).pipe((0,K.q)(1),(0,oe.h)(s)))}var ae=a(4825);function p(n,t=ie.z){const s=(0,ae.H)(n,t);return M(()=>s)}let re=0;const d=()=>++re;let l=[{userId:1,id:d(),title:"delectus aut autem",completed:!1},{userId:1,id:d(),title:"quis ut nam facilis et officia qui",completed:!1},{userId:1,id:d(),title:"fugiat veniam minus",completed:!1},{userId:1,id:d(),title:"et porro tempora",completed:!0},{userId:1,id:d(),title:"laboriosam mollitia et enim quasi adipisci quia provident illum",completed:!1},{userId:2,id:d(),title:"qui ullam ratione quibusdam voluptatem quia omnis",completed:!1},{userId:2,id:d(),title:"illo expedita consequatur quia in",completed:!1},{userId:2,id:d(),title:"quo adipisci enim quam ut ab",completed:!0},{userId:2,id:d(),title:"molestiae perspiciatis ipsa",completed:!1},{userId:3,id:d(),title:"illo est ratione doloremque quia maiores aut",completed:!0},{userId:3,id:d(),title:"vero rerum temporibus dolor",completed:!0},{userId:3,id:d(),title:"ipsa repellendus fugit nisi",completed:!0},{userId:3,id:d(),title:"et doloremque nulla",completed:!1},{userId:3,id:d(),title:"repellendus sunt dolores architecto voluptatum",completed:!0},{userId:3,id:d(),title:"ab voluptatum amet voluptas",completed:!0},{userId:4,id:d(),title:"accusamus eos facilis sint et aut voluptatem",completed:!0},{userId:4,id:d(),title:"quo laboriosam deleniti aut qui",completed:!0},{userId:4,id:d(),title:"dolorum est consequatur ea mollitia in culpa",completed:!1},{userId:4,id:d(),title:"molestiae ipsa aut voluptatibus pariatur dolor nihil",completed:!0},{userId:4,id:d(),title:"ullam nobis libero sapiente ad optio sint",completed:!0},{userId:5,id:d(),title:"suscipit repellat esse quibusdam voluptatem incidunt",completed:!1},{userId:5,id:d(),title:"distinctio vitae autem nihil ut molestias quo",completed:!0},{userId:5,id:d(),title:"et itaque necessitatibus maxime molestiae qui quas velit",completed:!1}];const F=n=>[...n.map(t=>({...t}))],x=(n,t)=>n.findIndex(({id:s})=>s===t),h=1500,de=n=>(0,m.of)(F(l)).pipe((0,b.U)(t=>t.filter(s=>s.userId===n)),p(h));let me=(()=>{var n;class t extends v{constructor(){super(de),this.map=F}update(i){this.mutationQueue((n=>{const t=x(l,n.id);if(-1===t)return(0,y._)(()=>new Error(`Unable to update todo with id=${n.id}`)).pipe(p(h));const{title:s,completed:i}=n;return l[t]={...l[t],title:s,completed:i},(0,m.of)({...l[t],title:s,completed:i}).pipe(p(h))})(i),(o,r)=>(o[x(o,r.id)]=r,o))}remove(i){this.mutationQueue((n=>{const t=x(l,n);if(-1===t)return(0,y._)(()=>new Error(`Unable to remove todo with id=${n}`)).pipe(p(h));const[s]=l.splice(t,1);return(0,m.of)(s).pipe(p(h))})(i),o=>{const r=x(o,i);return o.splice(r,1),o})}add(i){this.mutationQueue((n=>{const t=d();return l.push({...n,id:t}),(0,m.of)({...n,id:t}).pipe(p(h))})(i),(o,r)=>(o.push(r),o))}}return(n=t).\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),t})();function pe(n,t){if(1&n&&(e.TgZ(0,"h2"),e._uU(1),e.qZA()),2&n){const s=e.oxw();e.xp6(1),e.hij("Todo list for user with ID: ",s.userId||"","")}}function he(n,t){if(1&n){const s=e.EpF();e.TgZ(0,"p")(1,"button",7),e.NdJ("click",function(){const r=e.CHM(s).$implicit,u=e.oxw();return e.KtG(u.remove(r.id))}),e._uU(2,"Remove"),e.qZA(),e._uU(3," \xa0 "),e.TgZ(4,"mat-slide-toggle",8),e.NdJ("change",function(){const r=e.CHM(s).$implicit,u=e.oxw();return e.KtG(u.toggleCompleted(r))}),e.qZA(),e._uU(5," \xa0 "),e.TgZ(6,"mat-form-field",9)(7,"input",10,11),e.NdJ("change",function(){const r=e.CHM(s).$implicit,u=e.MAs(8),f=e.oxw();return e.KtG(f.updateTitle(r,u.value))}),e.qZA()(),e._uU(9),e.qZA()}if(2&n){const s=t.$implicit,i=e.oxw();e.xp6(1),e.Q6J("disabled",i.disabledTodoIds.has(s.id)),e.xp6(3),e.Q6J("disabled",i.disabledTodoIds.has(s.id))("checked",s.completed),e.xp6(3),e.Q6J("disabled",i.disabledTodoIds.has(s.id))("value",s.title),e.xp6(2),e.hij(" \xa0 ",s.completed?"\u2714":"\u2716"," ")}}function fe(n,t){if(1&n&&(e.TgZ(0,"pre",12),e._uU(1),e.ALo(2,"json"),e.qZA()),2&n){const s=t.ngIf;e.xp6(1),e.hij("Todos ",e.lcZ(2,1,s),"")}}const ge=[{path:"",component:(()=>{var n;class t{constructor(i){this.demoService=i,this.userId=0,this.disabledTodoIds=new Set,this.subscription=this.demoService.pending$.subscribe(o=>{!1===o&&this.disabledTodoIds.clear()})}ngOnDestroy(){this.subscription.unsubscribe()}fetch(){this.userId=1+this.userId%5,this.demoService.fetch(this.userId)}remove(i){this.demoService.remove(i),this.disabledTodoIds.add(i)}toggleCompleted(i){i.completed=!i.completed,this.demoService.update(i)}updateTitle(i,o){i.title=o,this.demoService.update(i)}trackById(i,{id:o}){return o}}return(n=t).\u0275fac=function(i){return new(i||n)(e.Y36(me))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-demo"]],standalone:!0,features:[e.jDz],decls:25,vars:14,consts:[["mat-raised-button","","color","primary",3,"disabled","click"],[4,"ngIf"],[1,"demo"],[1,"demo__form"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","demo__data",4,"ngIf"],["linkHref","https://github.com/avine/ng-libs/tree/main/src/app/rx-data-store/demo"],["mat-button","",3,"disabled","click"],[3,"disabled","checked","change"],["appearance","fill"],["matInput","",3,"disabled","value","change"],["input",""],[1,"demo__data"]],template:function(i,o){1&i&&(e.TgZ(0,"h1"),e._uU(1,"RxDataStore"),e.qZA(),e.TgZ(2,"p"),e._uU(3," Note that the server simulates a slow internet connection and each request takes 1.5 seconds."),e._UZ(4,"br"),e._uU(5," The request are queued using the "),e.TgZ(6,"code"),e._uU(7,"mutationQueue()"),e.qZA(),e._uU(8," method.\n"),e.qZA(),e.TgZ(9,"p")(10,"button",0),e.NdJ("click",function(){return o.fetch()}),e.ALo(11,"async"),e._uU(12," Fetch todos for the next user "),e.qZA(),e._uU(13," \xa0 "),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"async"),e.qZA()(),e.YNc(17,pe,2,1,"h2",1),e.TgZ(18,"div",2)(19,"div",3),e.YNc(20,he,10,6,"p",4),e.ALo(21,"async"),e.qZA(),e.YNc(22,fe,3,3,"pre",5),e.ALo(23,"async"),e.qZA(),e._UZ(24,"app-view-source",6)),2&i&&(e.xp6(10),e.Q6J("disabled",e.lcZ(11,6,o.demoService.pending$)),e.xp6(5),e.Oqu(e.lcZ(16,8,o.demoService.pending$)?"\u{1f680} Processing...":"\u{1f634} Idle."),e.xp6(2),e.Q6J("ngIf",o.userId),e.xp6(3),e.Q6J("ngForOf",e.lcZ(21,10,o.demoService.data$))("ngForTrackBy",o.trackById),e.xp6(2),e.Q6J("ngIf",e.lcZ(23,12,o.demoService.data$)))},dependencies:[g.Ov,g.Ts,g.O5,g.ax,A.ot,A.lW,U.lN,U.KE,Q.c,Q.Nt,E.rP,E.Rr,N.t],styles:[".demo[_ngcontent-%COMP%]{display:flex}.demo__form[_ngcontent-%COMP%]{flex-shrink:0}.demo__data[_ngcontent-%COMP%]{flex-grow:1;overflow:auto;margin:0 0 0 2rem;padding:.6rem .9rem;border-radius:4px;border:1px solid #eaeaea;background-color:#fafafa;font-size:13px;line-height:16px}@media (max-width: 1280px){.demo[_ngcontent-%COMP%]{flex-direction:column}.demo__data[_ngcontent-%COMP%]{margin-left:0}}"]}),t})()}]}}]);