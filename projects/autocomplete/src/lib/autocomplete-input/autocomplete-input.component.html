<input
  #inputRef
  cdkOverlayOrigin
  #dropDownOrigin="cdkOverlayOrigin"
  autocomplete="off"
  class="autocomplete-input__input"
  [class]="inputClass"
  [type]="type"
  [placeholder]="placeholder ?? ''"
  [readonly]="readonly"
  [disabled]="disabled"
  [value]="value"
  (focus)="onFocus()"
  (input)="onInput(inputRef.value)"
  (blur)="onBlur()"
  (keydown.ArrowUp)="onArrowUp($event)"
  (keydown.ArrowDown)="onArrowDown($event)"
  (keydown.Enter)="onEnter()"
  (keydown.Escape)="onEscape()"
/>

<ng-template
  *ngIf="suggestions$ | async as suggestions"
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="dropDownOrigin"
  [cdkConnectedOverlayOpen]="shouldDisplaySuggestions && suggestions.length > 0"
>
  <ng-container *ngTemplateOutlet="suggestionsTemplate ?? null"></ng-container>

  <div *ngIf="!suggestionsTemplate" class="autocomplete-input__suggestions" [style.width]="inputWidthPx">
    <div
      tabindex="0"
      autocompleteSuggestion
      *ngFor="let suggestion of suggestions; index as suggestionIndex; trackBy: trackBySuggestionValue"
      class="autocomplete-input__suggestion"
      [class.autocomplete-input__suggestion--focused]="suggestionIndex === focusedSuggestionIndex"
      (click)="selectSuggestion(suggestion)"
    >
      <span [innerHTML]="suggestion | autocompleteHighlightSuggestion: value"></span>

      <span *ngIf="suggestion === value" class="autocomplete-input__suggestion-check">&check;</span>
    </div>
  </div>
</ng-template>

<ng-content></ng-content>
