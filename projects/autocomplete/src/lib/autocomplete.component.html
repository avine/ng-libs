<input
  #inputRef
  cdkOverlayOrigin
  #dropDownOrigin="cdkOverlayOrigin"
  autocomplete="off"
  [type]="type"
  [placeholder]="placeholder ?? ''"
  [readonly]="readonly"
  [disabled]="disabled"
  [value]="value"
  (focus)="onFocus()"
  (input)="onInput(inputRef.value)"
  (blur)="onBlur()"
  (keydown.ArrowUp)="onArrowUp($event)"
  (keydown.ArrowDown)="onArrowDown($event)"
  (keydown.Enter)="onEnter()"
  (keydown.Escape)="onEscape()"
/>

<ng-template
  *ngIf="suggestions$ | async as suggestions"
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="dropDownOrigin"
  [cdkConnectedOverlayOpen]="shouldDisplaySuggestions && suggestions.length > 0"
>
  <ng-container
    *ngTemplateOutlet="
      suggestionsTemplate ?? null;
      context: { $implicit: suggestions, focusedSuggestionIndex: focusedSuggestionIndex }
    "
  ></ng-container>

  <div *ngIf="!suggestionsTemplate" class="autocomplete-datalist__suggestions">
    <div
      tabindex="0"
      *ngFor="let suggestion of suggestions; index as suggestionIndex; trackBy: trackBySuggestionValue"
      class="autocomplete-datalist__suggestion"
      [class.autocomplete-datalist__suggestion--focused]="suggestionIndex === focusedSuggestionIndex"
      autocompleteSuggestion
      (click)="selectSuggestion(suggestion)"
    >
      <span>
        <span *ngIf="suggestion.prefix" class="autocomplete-datalist__suggestion-prefix">{{ suggestion.prefix }}</span>
        <span [innerHTML]="highlightSuggestion(suggestion)"></span>
      </span>

      <em *ngIf="suggestion.value === value"> OK</em>
    </div>
  </div>
</ng-template>

<ng-content></ng-content>
