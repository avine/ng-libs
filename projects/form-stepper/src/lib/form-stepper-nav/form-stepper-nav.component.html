<ul *ngIf="state$ | async as state" class="sections">
  <li
    *ngIf="state.onboardingInfo"
    class="section"
    [class.section--valid]="state.maxStepIndexViewed >= 0"
    [class.section--current]="state.stepIndex === -1"
  >
    <button type="button" class="section__btn" (click)="navigateByStepIndex($event, state.onboardingInfo.index)">
      {{ state.onboardingInfo.title }}
    </button>
  </li>

  <li
    *ngFor="let section of state.nav; let sectionIndex = index"
    class="section"
    [class.section--valid]="section.offset <= state.maxStepIndexViewed && section.control.valid"
    [class.section--current]="state.sectionIndex === sectionIndex"
  >
    <button
      type="button"
      class="section__btn"
      [disabled]="section.offset > state.maxStepIndexViewed && section.steps[0].control.pristine"
      (click)="navigateByStepIndex($event, section.offset)"
    >
      {{ section.title }}

      <span *ngIf="state.sectionProgression && state.sectionIndex === sectionIndex">
        ({{ state.sectionProgression.count }}/{{ state.sectionProgression.total }})
      </span>
    </button>

    <ul *ngIf="section.steps.length >= 2" class="steps">
      <li
        *ngFor="let step of section.steps; let relativeStepIndex = index"
        class="step"
        [class.step--valid]="section.offset + relativeStepIndex <= state.maxStepIndexViewed && step.control.valid"
        [class.step--current]="state.stepIndex === section.offset + relativeStepIndex"
      >
        <button
          type="button"
          class="step__btn"
          [disabled]="section.offset + relativeStepIndex >= state.maxStepIndexViewed && step.control.pristine"
          (click)="navigateByStepIndex($event, section.offset + relativeStepIndex)"
        >
          {{ step.title }}
        </button>
      </li>
    </ul>
  </li>

  <li
    *ngIf="state.summaryInfo"
    class="section"
    [class.section--valid]="state.allStepsViewed"
    [class.section--current]="state.stepIndex === state.lastStepIndex"
  >
    <button
      type="button"
      class="section__btn"
      [disabled]="!state.allStepsViewed"
      (click)="navigateByStepIndex($event, state.summaryInfo.index)"
    >
      {{ state.summaryInfo.title }}
    </button>
  </li>
</ul>
